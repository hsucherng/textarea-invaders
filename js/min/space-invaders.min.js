$(function(){init()});function init(){$(window).keydown(function(a){if(a.keyCode==13){$(window).off("keydown");initStart()}})}function initStart(){$(window).bind({keydown:function(a){if(a.keyCode==32){if(!shot){shoot()}}else{if(a.keyCode==37){playerDirection="left"}else{if(a.keyCode==39){playerDirection="right"}else{if(a.keyCode==16){playerSpeed="fast"}}}}},keyup:function(a){if(a.keyCode==37||a.keyCode==39){playerDirection="none"}else{if(a.keyCode==16){playerSpeed="normal"}}}});refreshCanvas("game-start")}var width=100,height=36,canvas=$("#gameCanvas"),titleScreen=canvas.val().split("\n"),gameOverScreen=$("#gameOver").val().split("\n"),gameInterval,score=0,playerX=5,playerUpperStr="_/^\\_",playerLowerStr="|_____|",playerUpperDeathStr="*   *",playerLowerDeathStr="*  *  *",playerUpperWidth=5,playerLowerWidth=7,playerDirection="none",playerSpeed="normal",playerDead=false,playerLives=0,shot=true,shotX=playerX+3,shotY=height-4,alienX=5,alienY=3,alienXLimit=width-70,alienStartingY=3,alienDirection="right",aliens=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],alienArray=aliens.slice(0),alienRow=7,alienColumn=8,alienStr1=[' (v"v) ',' (;";) '],alienStr2=["\\('-')/","/('-')\\"],alienStr3=["(==V==)","(==A==)"],alienStrNum=0,alienWidth=7,alienShot=false,alienShotX=10,alienShotY=10,alienSpeed=800,alienTimeout,alienScore=50,bonus=false,bonusX=0,bonusUpperStr=["  _O_  ","  _0_  "],bonusLowerStr=["_/o_o\\_","_/_o_\\_"],bonusUpperDeathStr=" *   * ",bonusLowerDeathStr="*  *  *",bonusStrNum=0,bonusWidth=7,bonusSpeed=0.5,bonusScore=300,deathStr="+ *.* +",bunker=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1],bunker1=bunker.slice(0),bunker2=bunker.slice(0),bunker3=bunker.slice(0),bunker4=bunker.slice(0),bunkerArray=[bunker1,bunker2,bunker3,bunker4],bunkerX=9,bunkerWidth=13,bunkerGutter=10,_playerShoot=$("#SFXplayerShoot").get(0),_playerHit=$("#SFXplayerHit").get(0),_alienHit=$("#SFXalienHit").get(0),_bonusShip=$("#SFXbonusShip").get(0),_bonusHit=$("#SFXbonusHit").get(0);function initGame(){shot=false;gameInterval=setInterval(function(){var f="";if(playerDead){stopGame("lost-life");_playerHit.play()}if(alienArray.length<=1&&alienArray[0]==0){stopGame("WIN!")}if(!bonus){var e=Math.round(Math.random()*200);if(e==0){bonus=true;_bonusShip.play()}}if(playerDirection=="left"&&playerX>0){if(playerSpeed=="fast"){playerX-=2}else{playerX--}}else{if(playerDirection=="right"&&playerX<width-playerLowerWidth){if(playerSpeed=="fast"){playerX+=2}else{playerX++}}}for(var g=0;g<height-2;g++){if(g==0&&bonus){(bonusStrNum==0)?bonusStrNum=1:bonusStrNum=0;f+=setBonus();g++}else{if(g==alienY){var c=setAlien(g),h=c[0],b=c[1];f+=h;g+=b;if(alienY>=height-b-2){playerDead=true;playerLives=-1;_playerHit.play();stopGame("LOSE!");break}}else{if(g==height-9&&alienY<height-b-9){f+=setBunker(g);g+=4}else{if(g==height-3){for(var d=0;d<width;d++){if(d<4||d>width-5){f+=setFiller(d,g,".")}else{f+=setFiller(d,g," ")}}}else{for(var d=0;d<width;d++){f+=setFiller(d,g," ")}f+="\n"}}}}}f+="\n";if(shot&&shotY>0){shotY-=2}else{if(shot&&shotY<=0){shot=false}}if(alienShot&&alienShotY<height){alienShotY+=1}else{if(alienShot&&alienShotY>=height){alienShot=false}}f+=setPlayer();f+=setFooter();canvas.val(f)},50);function a(){findColumnLimit();alienTimeout=setTimeout(function(){if(alienX>=alienXLimit&&alienDirection=="right"){alienY+=2;alienDirection="left"}else{if(alienX<=1&&alienDirection=="left"){alienY+=2;alienDirection="right"}else{if(alienDirection=="right"){alienX++}else{if(alienDirection=="left"){alienX--}}}}(alienStrNum==0)?alienStrNum=1:alienStrNum=0;if(!alienShot){alienShoot()}a()},alienSpeed)}a()}function setPlayer(){var a="",c=playerX+1,e=playerX;for(var d=0;d<width;d++){if(d<c){if(alienShot&&alienShotY==height-2&&d==alienShotX){a+="["}else{if(alienShot&&alienShotY==height-3&&d==alienShotX){a+="]"}else{a+=" "}}}else{if(d==c){if(playerDead||alienShotY==height-2&&alienShotX>=d&&alienShotX<=d+playerUpperWidth){playerDead=true;alienShot=false;a+=playerUpperDeathStr}else{a+=playerUpperStr}d+=playerUpperWidth}else{if(d>c){if(alienShot&&alienShotY==height-2&&d-1==alienShotX){a+="["}else{if(alienShot&&alienShotY==height-3&&d-1==alienShotX){a+="]"}else{a+=" "}}}}}}a+="\n";for(var b=0;b<width;b++){if(b<e){if(alienShot&&alienShotY==height-1&&b==alienShotX){a+="["}else{if(alienShot&&alienShotY==height-2&&b==alienShotX){a+="]"}else{a+=" "}}}else{if(b==e){if(playerDead||alienShotY==39&&alienShotX>=b&&alienShotX<=b+playerLowerWidth||alienShotY==38&&alienShotX>=b&&alienShotX<=b+playerLowerWidth){playerDead=true;alienShot=false;alienShotY=0;a+=playerLowerDeathStr}else{a+=playerLowerStr}b+=playerLowerWidth}else{if(b>e){if(alienShot&&alienShotY==height-1&&b-1==alienShotX){a+="["}else{if(alienShot&&alienShotY==height-2&&b-1==alienShotX){a+="]"}else{a+=" "}}}}}}return a}function setAlien(c){var g="",n=0,m=1;for(var f=0;f<(alienRow*2);f++){for(var e=0;e<width;e++){if(e==alienX){for(var d=n*alienColumn;d<(n+1)*alienColumn;d++){if(alienArray[d]==1){if(shot){if(c+f==shotY||c+f==shotY+1){if(shotX>e&&shotX<e+alienWidth){score+=alienScore;g+=deathStr+" ";alienArray[d]=0;shot=false;_alienHit.play();if(alienArray.length<=1&&alienArray[0]==0){stopGame("WIN!")}else{alienSpeed-=14.32}}else{g+=getAlienStr(n)}}else{g+=getAlienStr(n)}}else{g+=getAlienStr(n)}}else{for(var l=0;l<8;l++){g+=setFiller(e+l,c+f," ")}}e+=alienWidth+1;if(d>=(n+1)*alienColumn-1){e--}}}else{g+=setFiller(e,c+f," ");if(e>=width-1){g+="\n";for(var h=0;h<width;h++){g+=setFiller(h,c+f," ");if(h>=width-1){g+="\n";f++;n++}}}}}if(f>=alienRow*2-1){m=f}}return[g,m]}function getAlienStr(a){if(a<2){return alienStr1[alienStrNum]+" "}else{if(a>=2&&a<4){return alienStr2[alienStrNum]+" "}else{if(a>=4&&a<8){return alienStr3[alienStrNum]+" "}}}}function setBonus(){var a="",d,e;for(var c=0;c<2;c++){if(c==0){d=bonusUpperStr[bonusStrNum];e=bonusUpperDeathStr}else{if(c==1){d=bonusLowerStr[bonusStrNum];e=bonusLowerDeathStr}}for(var b=0;b<width;b++){if(b==bonusX){if(shot){if(c==shotY||c==(shotY+1)){if(shotX>=b&&shotX<b+bonusWidth){a+=e;bonus=false;_bonusShip.pause();_bonusShip.currentTime=0;_bonusHit.play();if(c==1){score+=bonusScore;shot=false}}else{a+=d}}else{a+=d}}else{a+=d}b+=bonusWidth-1}else{a+=setFiller(b,c," ")}}if(c==1){bonusX++;if(!bonus){bonusX=0;_bonusShip.pause();_bonusShip.currentTime=0}if(bonusX>=width-bonusWidth){bonus=false;bonusX=0;_bonusShip.pause();_bonusShip.currentTime=0}}a+="\n"}return a}function setBunker(g){var c="";for(var f=0;f<5;f++){for(var e=0;e<width;e++){if(e==bunkerX){for(var d=0;d<bunkerArray.length;d++){for(var b=f*bunkerWidth;b<(f+1)*bunkerWidth;b++){var h=e+b-f*bunkerWidth;if(bunkerArray[d][b]==1){if(alienShot&&g+f==alienShotY+1&&h==alienShotX||shot&&g+f==shotY&&h==shotX||shot&&g+f==shotY+1&&h==shotX){if(alienShot){alienShot=false}else{shot=false}bunkerArray[d][b]=0;c+="*"}else{c+="="}}else{c+=setFiller(h,g+f," ")}}for(var a=0;a<bunkerGutter;a++){c+=setFiller(e+bunkerWidth+a,g+f," ")}e+=bunkerWidth+bunkerGutter}e--}else{c+=setFiller(e,g+f," ")}}c+="\n"}return c}function setFiller(c,a,b){if(shot&&a==shotY&&c==shotX||shot&&a==shotY+1&&c==shotX){return"|"}else{if(alienShot&&a==alienShotY&&c==alienShotX){return"["}else{if(alienShot&&a==alienShotY+1&&c==alienShotX){return"]"}else{return b}}}}function findColumnLimit(){if(alienColumn>0){for(var f=0;f<=alienArray.length;f+=alienColumn){if(alienArray[f]==1){break}else{if(f>=alienArray.length){for(var e=alienArray.length;e>=0;e-=alienColumn){if(alienArray.length>1){alienArray.splice(e,1);if(e<=0){alienX+=8;alienXLimit+=8;alienColumn--;break}}}}}}for(var d=alienColumn-1;d<=alienArray.length;d+=alienColumn){if(alienArray[d]==1){break}else{if(d>=alienArray.length-1){for(var c=alienArray.length-1;c>=0;c-=alienColumn){if(alienArray.length>1){alienArray.splice(c,1);if(c<=alienColumn-1){alienXLimit+=8;alienColumn--;break}}}}}}}if(alienRow>0){for(var g=alienArray.length-1;g>=alienArray.length-alienColumn;g--){if(alienArray[g]==1){break}else{if(g<=alienArray.length-alienColumn){if(alienArray.length>1){alienArray.splice(alienArray.length-alienColumn,alienColumn);alienRow--;break}}}}}}function setFooter(){var f="",h=5,e="  ",g=2,b=1;for(var d=0;d<6;d++){for(var c=0;c<width;c++){if(d==2){f+="="}else{if(d==4){if(c<h||c>h){if(c>width-5){f+=score;c+=4}else{f+=" "}}else{if(c==h){for(var a=0;a<playerLives;a++){f+=" "+playerUpperStr+" "+e;c+=playerUpperWidth+2+g}}}}else{if(d==5){if(c<h||c>h){f+=" "}else{if(c==h){for(var a=0;a<playerLives;a++){f+=playerLowerStr+e;c+=playerLowerWidth+g}}}}}}}f+="\n"}return f}function shoot(){shotX=playerX+3;shotY=height-4;shot=true;_playerShoot.play()}function alienShoot(){var b=Math.round(Math.random()*(alienColumn-1)+1),c=a(b);while(c==0){b=Math.round(Math.random()*alienColumn);c=a(b)}alienShotX=alienX+3+(b-1)*8;alienShotY=c*2+alienY-1;alienShot=true;function a(f){var e=alienArray.length-alienColumn-1+f,g=alienRow;for(var d=e;d>=0;d-=alienColumn){if(alienArray[d]==0){g--;if(d<=alienColumn-1&&g==0){return g}}else{if(alienArray[d]==1){return g}}}}}function stopGame(a){clearInterval(gameInterval);clearTimeout(alienTimeout);_bonusShip.pause();_bonusShip.currentTime=0;if(a=="lost-life"){playerLives--;bonus=false;setTimeout(function(){playerDead=false;playerX=5;if(playerLives<0){refreshCanvas("game-over");setTimeout(function(){refreshCanvas("game-title");init()},3000)}else{initGame()}},1500)}else{if(a!="none"){$("body").append("<span>"+a+"</span>");setTimeout(function(){$("body").find("span").remove();if(a=="WIN!"){canvas.val(" ")}setTimeout(function(){if(a=="LOSE!"){refreshCanvas("game-over");setTimeout(function(){refreshCanvas("game-title");init()},3000)}else{resetGame()}},1000)},1500)}}if(a=="WIN!"){alienStartingY+=2}}function resetGame(a){playerX=5;playerDead=false;if(a=="whole-game"){playerLives=3;alienStartingY=5;score=0}shot=false;alienX=5;alienY=alienStartingY;alienXLimit=30;alienDirection="right";alienRow=7;alienColumn=8;alienSpeed=800;alienArray=aliens.slice(0);alienShot=false;bonus=false;bunker1=bunker.slice(0);bunker2=bunker.slice(0);bunker3=bunker.slice(0);bunker4=bunker.slice(0);bunkerArray=[bunker1,bunker2,bunker3,bunker4];if(bonus){_bonusShip.play()}initGame()}function refreshCanvas(e){var d=canvas.val().split("\n"),a=(e=="game-over")?10:0,f=(e=="game-over")?10+gameOverScreen.length:d.length,b;b=setInterval(function(){if(e=="game-title"){d[a]=titleScreen[a]}else{if(e=="game-over"){d[a]=gameOverScreen[a-10]}else{d[a]=c()}}canvas.val(d.join("\n"));a++;if(a>=f){clearInterval(b);a=0;if(e=="game-start"){resetGame("whole-game")}}},50);function c(){var g="";for(var h=width;h>0;h--){g+=" "}return g}};